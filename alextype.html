<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AlexType ‚Äî –¢—Ä–µ–Ω–∞–∂—ë—Ä –ø–µ—á–∞—Ç–∏</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-void: #08080c;
      --bg-deep: #0e0e14;
      --bg-surface: #14141c;
      --bg-elevated: #1a1a24;
      --bg-hover: #222230;

      --text-bright: #f5f5f7;
      --text-primary: #e0e0e5;
      --text-secondary: #9898a8;
      --text-muted: #6a6a78;

      --accent: #8b5cf6;
      --accent-soft: #a78bfa;
      --accent-glow: rgba(139, 92, 246, 0.3);

      --success: #34d399;
      --success-soft: rgba(52, 211, 153, 0.15);
      --warning: #fbbf24;
      --danger: #f87171;

      --border: rgba(139, 92, 246, 0.12);
      --border-subtle: rgba(255, 255, 255, 0.06);

      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-void);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 24px 16px;
      background-image:
        radial-gradient(ellipse at 20% 0%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(52, 211, 153, 0.05) 0%, transparent 50%);
    }

    .wrap {
      max-width: 860px;
      margin: 0 auto;
      display: grid;
      gap: 16px;
    }

    /* ===== HEADER ===== */
    .header-card {
      background: linear-gradient(135deg, var(--bg-surface) 0%, var(--bg-elevated) 100%);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 24px 28px;
      position: relative;
      overflow: hidden;
    }

    .header-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--success), var(--warning));
      opacity: 0.7;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      width: 42px;
      height: 42px;
      background: linear-gradient(135deg, var(--accent), #6d28d9);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 0 20px var(--accent-glow);
    }

    .logo h1 {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.5px;
      background: linear-gradient(135deg, var(--accent-soft) 0%, var(--text-bright) 50%, var(--success) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .logo-sub {
      color: var(--text-secondary);
      font-size: 13px;
      margin-top: 6px;
      margin-left: 54px;
    }

    /* ===== BACK LINK ===== */
    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 4px;
      transition: color 0.2s;
    }

    .back-link:hover {
      color: var(--accent-soft);
    }

    /* ===== CARDS ===== */
    .card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      padding: 20px;
      transition: border-color 0.3s;
    }

    .card:hover {
      border-color: var(--border);
    }

    /* ===== CONTROLS ===== */
    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    select {
      background: var(--bg-deep);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      cursor: pointer;
      outline: none;
      transition: border-color 0.2s;
    }

    select:focus {
      border-color: var(--accent);
    }

    button {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 10px 18px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      background: var(--bg-hover);
      border-color: var(--border);
      transform: translateY(-1px);
    }

    button.primary {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(139, 92, 246, 0.1));
      border-color: rgba(139, 92, 246, 0.4);
      color: var(--accent-soft);
    }

    button.primary:hover {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(139, 92, 246, 0.15));
      border-color: var(--accent);
      box-shadow: 0 0 16px var(--accent-glow);
    }

    .status {
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 500;
      margin-left: auto;
    }

    /* ===== TYPING AREA ===== */
    .sample {
      line-height: 1.75;
      font-size: 17px;
      background: var(--bg-deep);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 16px;
      min-height: 100px;
      white-space: pre-wrap;
      font-family: 'Inter', monospace;
      margin-bottom: 12px;
      letter-spacing: 0.2px;
    }

    .sample .ok {
      color: var(--success);
      text-shadow: 0 0 8px rgba(52, 211, 153, 0.3);
    }

    .sample .bad {
      color: var(--danger);
      text-decoration: underline;
      text-underline-offset: 3px;
      text-shadow: 0 0 8px rgba(248, 113, 113, 0.3);
    }

    .sample .rest {
      color: var(--text-muted);
    }

    .sample .cursor-char {
      color: var(--text-bright);
      background: rgba(139, 92, 246, 0.25);
      border-radius: 2px;
      padding: 0 1px;
    }

    textarea {
      width: 100%;
      min-height: 100px;
      background: var(--bg-deep);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 16px;
      font-size: 16px;
      font-family: 'Inter', monospace;
      line-height: 1.65;
      resize: vertical;
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
      letter-spacing: 0.2px;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 20px var(--accent-glow);
    }

    /* ===== STATS ===== */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .stat {
      background: var(--bg-deep);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 14px 16px;
      text-align: center;
      transition: border-color 0.3s, transform 0.2s;
    }

    .stat:hover {
      border-color: var(--border);
      transform: translateY(-2px);
    }

    .stat-label {
      display: block;
      color: var(--text-muted);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 6px;
    }

    .stat-value {
      display: block;
      color: var(--text-bright);
      font-size: 22px;
      font-weight: 700;
    }

    .stat:nth-child(1) .stat-value {
      color: var(--accent-soft);
    }

    .stat:nth-child(2) .stat-value {
      color: var(--success);
    }

    .stat:nth-child(3) .stat-value {
      color: var(--warning);
    }

    .stat:nth-child(4) .stat-value {
      color: var(--text-bright);
    }

    .status-ok {
      color: var(--success) !important;
      font-weight: 600;
    }

    .status-bad {
      color: var(--danger) !important;
      font-weight: 600;
    }

    /* ===== XP TOAST ===== */
    .xp-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.9), rgba(109, 40, 217, 0.9));
      border: 1px solid rgba(139, 92, 246, 0.6);
      border-radius: var(--radius-md);
      padding: 16px 24px;
      color: var(--text-bright);
      font-weight: 700;
      font-size: 18px;
      z-index: 9999;
      animation: xpSlideIn 0.4s ease-out, xpFadeOut 0.4s ease-in 2.6s forwards;
      box-shadow: 0 0 30px var(--accent-glow), 0 8px 32px rgba(0, 0, 0, 0.4);
      pointer-events: none;
    }

    .xp-toast .xp-sub {
      font-size: 12px;
      font-weight: 500;
      color: var(--accent-soft);
      margin-top: 4px;
    }

    @keyframes xpSlideIn {
      from {
        transform: translateX(100px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes xpFadeOut {
      to {
        opacity: 0;
        transform: translateY(-20px);
      }
    }

    .xp-preview {
      font-size: 12px;
      color: var(--text-muted);
      margin-left: auto;
      padding: 4px 10px;
      background: var(--bg-deep);
      border-radius: 6px;
      border: 1px solid var(--border-subtle);
    }

    /* ===== LEVEL BADGE ===== */
    .level-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .level-badge.D {
      background: rgba(34, 197, 94, 0.15);
      color: #22c55e;
    }

    .level-badge.C {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
    }

    .level-badge.B {
      background: rgba(168, 85, 247, 0.15);
      color: #a855f7;
    }

    .level-badge.A {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
    }

    .level-badge.S {
      background: linear-gradient(135deg, rgba(244, 63, 94, 0.15), rgba(245, 158, 11, 0.15));
      color: #f43f5e;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 640px) {
      body {
        padding: 12px 8px;
      }

      .stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .sample {
        font-size: 15px;
        min-height: 80px;
      }

      textarea {
        font-size: 15px;
      }

      .logo h1 {
        font-size: 20px;
      }

      .controls {
        gap: 8px;
      }

      .status {
        margin-left: 0;
        width: 100%;
        margin-top: 4px;
      }

      .xp-preview {
        display: none;
      }
    }

    @media (prefers-reduced-motion: reduce) {

      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <a href="/" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ê–∫–∞–¥–µ–º–∏—é</a>

    <div class="header-card">
      <div class="logo">
        <div class="logo-icon">‚å®Ô∏è</div>
        <h1>AlexType</h1>
      </div>
      <div class="logo-sub">–¢—Ä–µ–Ω–∞–∂—ë—Ä –ø–µ—á–∞—Ç–∏ –ê–∫–∞–¥–µ–º–∏–∏ Pandora ‚Äî —É—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Ç–æ—á–Ω–æ—Å—Ç—å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å ‚Üí XP</div>
    </div>

    <div class="card controls">
      <label for="level" style="font-weight:600;font-size:14px;">–£—Ä–æ–≤–µ–Ω—å:</label>
      <select id="level">
        <option value="D">D ‚Äî –ù–æ–≤–∏—á–æ–∫</option>
        <option value="C">C ‚Äî –£—á–µ–Ω–∏–∫</option>
        <option value="B">B ‚Äî –í–æ–∏–Ω</option>
        <option value="A">A ‚Äî –ú–∞—Å—Ç–µ—Ä</option>
        <option value="S">S ‚Äî –õ–µ–≥–µ–Ω–¥–∞</option>
      </select>
      <span id="levelBadge" class="level-badge D">D</span>
      <button id="newText" class="primary">‚ú® –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç</button>
      <button id="reset">üîÑ –°–±—Ä–æ—Å</button>
      <span id="xpPreview" class="xp-preview">~5-8 XP</span>
      <span id="status" class="status">–ì–æ—Ç–æ–≤–æ –∫ —Å—Ç–∞—Ä—Ç—É</span>
    </div>

    <div class="card">
      <div id="sample" class="sample"></div>
      <textarea id="input" placeholder="–ù–∞—á–Ω–∏ –ø–µ—á–∞—Ç–∞—Ç—å –∑–¥–µ—Å—å..." autocomplete="off" spellcheck="false"></textarea>
    </div>

    <div class="stats">
      <div class="stat">
        <span class="stat-label">–°–∏–º–≤–æ–ª—ã</span>
        <span class="stat-value" id="chars">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</span>
        <span class="stat-value" id="accuracy">100%</span>
      </div>
      <div class="stat">
        <span class="stat-label">CPM</span>
        <span class="stat-value" id="cpm">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">–í—Ä–µ–º—è</span>
        <span class="stat-value" id="time">0s</span>
      </div>
    </div>
  </div>

  <script>
    // ===== TEXT POOLS BY DIFFICULTY =====
    // D: ~15-30 chars (short, simple)
    // C: ~30-60 chars
    // B: ~60-100 chars
    // A: ~100-150 chars
    // S: ~150-250 chars
    const TEXTS_BY_LEVEL = {
      D: [
        "–ü—Ä–∏–≤–µ—Ç –º–∏—Ä.",
        "–î–æ–±—Ä—ã–π –¥–µ–Ω—å.",
        "–°–∫–æ—Ä–æ –ª–µ—Ç–æ.",
        "–ß–∏—Å—Ç—ã–π –∫–æ–¥.",
        "–ö–Ω–∏–≥–∞ –Ω–∞ —Å—Ç–æ–ª–µ.",
        "–°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏—Ç —è—Ä–∫–æ.",
        "–Ø –ª—é–±–ª—é —É—á–∏—Ç—å—Å—è.",
        "–ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.",
        "–ü—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–ø—É—â–µ–Ω–∞.",
        "–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ.",
      ],
      C: [
        "–ò–∑ —Å—É–Ω–¥—É–∫–∞ –ø–µ—Ä–≤—ã–º –¥–æ—Å—Ç–∞—é—Ç —Ç–æ, —á—Ç–æ —Å–≤–µ—Ä—Ö—É.",
        "–°–º–µ–ª–æ—Å—Ç—å –≥–æ—Ä–æ–¥–∞ –±–µ—Ä–µ—Ç.",
        "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø–∏—à–µ—Ç –∫–æ–¥ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.",
        "–¢–∞–π–≥–∞ —Å—Ç–æ—è–ª–∞ —Ç–∏—Ö–∞—è –∏ –≤–µ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è.",
        "–†–æ—Å–∞ –±–ª–µ—Å—Ç–µ–ª–∞ –Ω–∞ —Ç—Ä–∞–≤–µ –∫–∞–∫ –∞–ª–º–∞–∑—ã.",
        "–î—Ä—É–∂–±–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å –ª—é–±—ã–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏.",
        "–ß–µ—Å—Ç–Ω–æ–µ —Å–ª–æ–≤–æ - —ç—Ç–æ –Ω–µ –ø—É—Å—Ç–æ–π –∑–≤—É–∫.",
        "–£—á–µ–Ω—å–µ - —Å–≤–µ—Ç, –∞ –Ω–µ—É—á–µ–Ω—å–µ - —Ç—å–º–∞.",
        "–ö–∞–∂–¥–∞—è –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞ –¥–µ–ª–∞–µ—Ç –º–∏—Ä –ª—É—á—à–µ.",
        "JavaScript - —è–∑—ã–∫ –¥–ª—è –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.",
      ],
      B: [
        "–ö–∞–ø–∏—Ç–∞–Ω —Å–º–æ—Ç—Ä–µ–ª –≤ –ø–æ–¥–∑–æ—Ä–Ω—É—é —Ç—Ä—É–±—É, –∞ –Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–µ –ø–æ–∫–∞–∑–∞–ª–∞—Å—å –∑–µ–º–ª—è.",
        "–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –≥–µ–Ω–∏–π —Å–ø–æ—Å–æ–±–µ–Ω –ø–æ–∫–æ—Ä–∏—Ç—å —Å—Ç–∏—Ö–∏–∏, –µ—Å–ª–∏ –Ω–µ —Ç–µ—Ä—è–µ—Ç –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É.",
        "–°–µ–≤–µ—Ä –Ω–µ –ø—Ä–æ—â–∞–µ—Ç –æ—à–∏–±–æ–∫, –æ–Ω –∂–µ—Å—Ç–æ–∫ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤.",
        "–ù–∞—É—Ç–∏–ª—É—Å –ø–ª—ã–ª –ø–æ–¥ –≤–æ–¥–æ–π —Å –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é, —Ä–∞—Å—Å–µ–∫–∞—è –≥–ª—É–±–∏–Ω—ã.",
        "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –∫ —Ü–µ–Ω—Ç—Ä—É –ó–µ–º–ª–∏ –Ω–∞—á–∞–ª–æ—Å—å —Å –∫—Ä–∞—Ç–µ—Ä–∞ –ø–æ—Ç—É—Ö—à–µ–≥–æ –≤—É–ª–∫–∞–Ω–∞.",
        "–•–æ—Ä–æ—à–∏–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø–∏—à–µ—Ç –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º–æ–≥—É—Ç –ø–æ–Ω—è—Ç—å –¥—Ä—É–≥–∏–µ –ª—é–¥–∏.",
        "–ê–ª–≥–æ—Ä–∏—Ç–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –º–∞—Å—Å–∏–≤–∞ - –æ–¥–Ω–∞ –∏–∑ –±–∞–∑–æ–≤—ã—Ö –∑–∞–¥–∞—á –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏.",
        "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–æ–≤—ã–µ –≤—ã–∑–æ–≤—ã –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–æ—Å—Ç–∞.",
        "–§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –¥–µ–ª–∞—Ç—å –æ–¥–Ω—É –≤–µ—â—å –∏ –¥–µ–ª–∞—Ç—å –µ—ë —Ö–æ—Ä–æ—à–æ.",
        "–í –º–∏—Ä–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ - —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å.",
      ],
      A: [
        "–ü–æ–±–µ–∂–¥–∞–µ—Ç —Ç–æ—Ç, –∫—Ç–æ –Ω–µ —Å–¥–∞–µ—Ç—Å—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∑–¥–æ—Ö–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —è—Å–Ω–æ—Å—Ç—å –º—ã—Å–ª–∏.",
        "–ë—ç–∫ –∂–∏–ª –≤ –±–æ–ª—å—à–æ–º –¥–æ–º–µ —Å —à–∏—Ä–æ–∫–æ–π –≤–µ—Ä–∞–Ω–¥–æ–π, —É–≤–∏—Ç–æ–π —Ä–æ–∑–∞–º–∏, –∏ –±—ã–ª –∫–æ—Ä–æ–ª–µ–º –ø–æ–º–µ—Å—Ç—å—è.",
        "–§–∏–ª–µ–∞—Å –§–æ–≥–≥ –±—ã–ª —Å–ø–æ–∫–æ–µ–Ω –∏ –Ω–µ–≤–æ–∑–º—É—Ç–∏–º –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –≤—Ä–µ–º—è —à–ª–æ –ø—Ä–æ—Ç–∏–≤ –Ω–µ–≥–æ.",
        "–û–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –º–∏—Ä —Å –ø–æ–º–æ—â—å—é –∫–ª–∞—Å—Å–æ–≤ –∏ –æ–±—ä–µ–∫—Ç–æ–≤.",
        "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –µ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ—Ç—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.",
        "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –º–µ–Ω—è–µ—Ç –º–∏—Ä –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –º—ã —É—Å–ø–µ–≤–∞–µ–º –æ—Å–º—ã—Å–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è —ç—Ç–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.",
        "–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.",
        "–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞ - —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã.",
      ],
      S: [
        "–ù–µ—Ç –Ω–∏—á–µ–≥–æ –Ω–∏ —Ö–æ—Ä–æ—à–µ–≥–æ, –Ω–∏ –ø–ª–æ—Ö–æ–≥–æ; —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç –≤—Å–µ —Ç–∞–∫–æ–≤—ã–º, –∏ –∏–º–µ–Ω–Ω–æ –≤ —ç—Ç–æ–º —Å–∏–ª–∞ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞.",
        "–ë—ã—Ç—å –∏–ª–∏ –Ω–µ –±—ã—Ç—å, –≤–æ—Ç –≤ —á–µ–º –≤–æ–ø—Ä–æ—Å: –¥–æ—Å—Ç–æ–π–Ω–æ –ª–∏ —Å–º–∏—Ä—è—Ç—å—Å—è –ø–æ–¥ —É–¥–∞—Ä–∞–º–∏ —Å—É–¥—å–±—ã –∏–ª–∏ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è—Ç—å—Å—è –º–æ—Ä—é –±–µ–¥—Å—Ç–≤–∏–π.",
        "–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–∑–±–∏–≤–∞–µ—Ç –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å.",
        "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é Docker –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø–∞–∫–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –≤ –ª—é–±–æ–π —Å—Ä–µ–¥–µ.",
        "–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É—é—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∫–æ–¥–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ä–µ–¥—É.",
        "–ü–∞—Ç—Ç–µ—Ä–Ω –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–∞–º –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.",
      ],
    };

    const XP_PREVIEW = { D: "~5-8", C: "~14-21", B: "~35-50", A: "~65-98", S: "~120-160" };
    const API_URL = window.location.origin;

    function getAuthToken() {
      return localStorage.getItem("auth_token") || "";
    }

    const levelEl = document.getElementById("level");
    const badgeEl = document.getElementById("levelBadge");
    const sampleEl = document.getElementById("sample");
    const inputEl = document.getElementById("input");
    const statusEl = document.getElementById("status");
    const charsEl = document.getElementById("chars");
    const accuracyEl = document.getElementById("accuracy");
    const cpmEl = document.getElementById("cpm");
    const timeEl = document.getElementById("time");
    const xpPreviewEl = document.getElementById("xpPreview");

    let targetText = "";
    let startedAt = 0;
    let timer = null;
    let rewardSent = false;

    function pickText() {
      const arr = TEXTS_BY_LEVEL[levelEl.value] || TEXTS_BY_LEVEL.D;
      targetText = arr[Math.floor(Math.random() * arr.length)];
      inputEl.value = "";
      startedAt = 0;
      clearInterval(timer);
      timer = null;
      rewardSent = false;
      renderSample();
      setStats();
      setStatus("–ì–æ—Ç–æ–≤–æ –∫ —Å—Ç–∞—Ä—Ç—É", "");
      updateBadge();
      updateXPPreview();
      inputEl.focus();
    }

    function updateBadge() {
      const lv = levelEl.value;
      badgeEl.textContent = lv;
      badgeEl.className = `level-badge ${lv}`;
    }

    function updateXPPreview() {
      const lv = levelEl.value;
      xpPreviewEl.textContent = `${XP_PREVIEW[lv] || "~5"} XP`;
    }

    function setStatus(text, cls) {
      statusEl.textContent = text;
      statusEl.className = `status ${cls || ""}`.trim();
    }

    function renderSample() {
      const typed = inputEl.value;
      let ok = "";
      let bad = "";
      let i = 0;
      while (i < typed.length && i < targetText.length && typed[i] === targetText[i]) {
        ok += targetText[i];
        i++;
      }
      if (i < typed.length && i < targetText.length) bad = targetText[i];
      const cursorIdx = i + (bad ? 1 : 0);
      const cursorChar = cursorIdx < targetText.length ? targetText[cursorIdx] : '';
      const rest = targetText.slice(cursorIdx + (cursorChar ? 1 : 0));

      sampleEl.innerHTML =
        `<span class="ok">${esc(ok)}</span>` +
        `<span class="bad">${esc(bad)}</span>` +
        (cursorChar ? `<span class="cursor-char">${esc(cursorChar)}</span>` : '') +
        `<span class="rest">${esc(rest)}</span>`;
    }

    function esc(s) {
      return String(s).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }

    function getAccuracy() {
      const typed = inputEl.value;
      const total = typed.length;
      let correct = 0;
      for (let i = 0; i < total; i++) {
        if (typed[i] === targetText[i]) correct++;
      }
      return total > 0 ? correct / total : 1;
    }

    function setStats() {
      const typed = inputEl.value;
      const total = typed.length;
      let correct = 0;
      for (let i = 0; i < total; i++) {
        if (typed[i] === targetText[i]) correct++;
      }
      const elapsedMs = startedAt ? Date.now() - startedAt : 0;
      const elapsedMin = elapsedMs > 0 ? (elapsedMs / 60000) : 0;
      const cpm = elapsedMin > 0 ? Math.round(correct / elapsedMin) : 0;
      const acc = total > 0 ? Math.round((correct / total) * 100) : 100;

      charsEl.textContent = String(total);
      accuracyEl.textContent = `${acc}%`;
      cpmEl.textContent = String(cpm);
      timeEl.textContent = `${Math.floor(elapsedMs / 1000)}s`;
    }

    function showXPToast(xp, message) {
      const existing = document.querySelector('.xp-toast');
      if (existing) existing.remove();

      const toast = document.createElement('div');
      toast.className = 'xp-toast';
      toast.innerHTML = `‚ö° +${xp} XP<div class="xp-sub">${esc(message)}</div>`;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3200);
    }

    async function claimXP() {
      if (rewardSent) return;
      rewardSent = true;

      const token = getAuthToken();
      if (!token) {
        setStatus("‚úÖ PASSED (–≤–æ–π–¥–∏ –¥–ª—è XP)", "status-ok");
        return;
      }

      const accuracy = getAccuracy();
      const elapsedMs = startedAt ? Date.now() - startedAt : 0;
      const elapsedMin = elapsedMs > 0 ? (elapsedMs / 60000) : 0;
      const cpmVal = elapsedMin > 0 ? Math.round(targetText.length / elapsedMin) : 0;

      try {
        const resp = await fetch(`${API_URL}/api/alextype/complete`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`,
          },
          body: JSON.stringify({
            level: levelEl.value,
            chars_typed: inputEl.value.length,
            accuracy: accuracy,
            text_length: targetText.length,
            cpm: cpmVal,
          }),
        });
        const data = await resp.json();
        if (data.xp_awarded > 0) {
          showXPToast(data.xp_awarded, data.message || '–ó–∞ –Ω–∞–±–æ—Ä —Ç–µ–∫—Å—Ç–∞');
          setStatus(`‚úÖ PASSED +${data.xp_awarded} XP`, "status-ok");
        } else {
          setStatus(`‚úÖ PASSED ‚Äî ${data.message || ''}`, "status-ok");
        }
      } catch (e) {
        console.warn('AlexType XP claim failed:', e);
        setStatus("‚úÖ PASSED", "status-ok");
      }
    }

    inputEl.addEventListener("input", () => {
      if (!startedAt && inputEl.value.length > 0) {
        startedAt = Date.now();
        timer = setInterval(setStats, 200);
      }
      renderSample();
      setStats();

      if (inputEl.value === targetText) {
        clearInterval(timer);
        timer = null;
        claimXP();
      } else if (inputEl.value.length >= targetText.length) {
        setStatus("‚ùå FAILED", "status-bad");
      } else {
        setStatus("‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ...", "");
      }
    });

    document.getElementById("newText").addEventListener("click", pickText);
    document.getElementById("reset").addEventListener("click", pickText);
    levelEl.addEventListener("change", pickText);

    pickText();
  </script>
</body>

</html>